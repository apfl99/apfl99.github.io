---
title: "블록체인 인프라 아키텍처"
categories:
 - BEB
tags: [] 
toc: true
author_profile: true #profile sidebar 감추기
# sidebar:
#     nav: "docs" # 목차 사이드바
search: true #검색 피하기



---



# 블록체인 인프라 아키텍처

---



## CAP이론

![1](../../images/2022-10-24-blockchainArch/1.png)

{: .align-center}

CAP이론은 분산 데이터베이스 시스템을 바탕으로, 네트워크 분할 허용이 이루어지는 경우에 일관성, 가용성을 동시에 만족하는 것은 불가능하며, 일관성과 가용성 중 하나만 가질 수 있다는 이론이다.



### CAP 요소

---

- 분할 허용(P : Partition Tolerance) : 여러 개의 네트워크가 동작하고 있을 때 접속이 단절되어 서로 메시지를 주고받지 못하더라도 서비스가 잘 동작해야 한다.
- 일관성(C : Consistency) : 분산 시스템에서의 요청 및 응답 과정에서, 노드가 여러 개 있더라도 마치 한 노드에서 실행되는 것처럼 동작해야 한다.
- 가용성(A : Availability) : 분산 시스템이 지속해서 가용하기 위해서 장애 없는 노드에 수신된 모든 요청은 반드시 응답돼야 한다.



#### CAP의 상관관계

- CA : 일관성과 가용성을 충족하지만 분할 허용을 충족하지 못한다. 데이터에 대한 강한 신뢰를 부여할 수 있지만, 네트워크 문제가 시스템 중단을 야기할 수 있다.
- CP : 일관성과 분할 허용을 충족하지만 가용성을 충족하지 못한다. 높은 확장성으로부터 성능을 확보할 수 있지만 일부 데이터가 비가용할 수 있다.
- AP : 가용성과 분할 허용을 충족하지만 일관성을 충족하지 못한다. 부정확한 응답을 허용하는 고성능 시스템에 적합하다.



### P : 네트워크 분할 허용

---

- 노드 간의 통신이 실질적으로 어려운 상태에 도달하여 네트워크가 사실상 분할되었을 때도 마치 단일네트워크처럼 네트워크가 정상적으로 작동한다.

네트워크 분할 허용을 전제하는 네트워크는 노드 간의 통신이 완전히 불가능하거나 비동기성 네트워크에서 메시지가 유실될 수 있고, 현실성이 떨어지는 시간에 메시지가 전달될 수 있다.

모든 분산 네트워크는 네트워크 분할 허용성을 보유할 수 밖에 없다. 따라서 CAP이론에서는 네트워크 분할 허용(P)를 기본으로 전제한다.



### C : 일관성

---

- 모든 요청은 최신 데이터 또는 에러 응답을 받는다

일관성은 즉, 한 노드에서 특정 데이터의 처리가 완료되었을 때 다른 노드가 동시다발적으로 업데이트된 정보에 접근할 수 있어야 한다.(Linearizability 기준)



### A : 가용성

---

- 정상적으로 이루어진 모든 요청은 정상적으로 작동하고 있는 모든 노드로부터 응답을 받는다.

일반적으로 높은 가용성은 시스템 자체가 모든 요청에 대한 정상적인 응답을 할 수 있다는 것을 전제한다. 따라서 하나의 정상 노드만 응답해도 시스템은 가용하다고 판단되며, 여기서는 현실적인 응답시간을 고려한다.

그러나 CAP이론에서의 가용성은 오류가 없는 노드가 발송한 메시지는 오류가 없는 모든 노드로부터 응답을 받을 수 있어야 하고, 데이터 저장소에 대한 모든 동작이 오류가 없는 모든 노드로부터 성공적으로 리턴받아야 하기 때문에 일반적인 높은 가용성보다 훨씬 높은 난이도를 요구한다. 그리고 CAP이론의 가용성은 응답시간에 제한을 걸어두지 않아 실제 사용에 부적합할 수 있다는 단점이 있다.



## PACELC 이론

CAP이론에 따르면 일관성과 가용성은 완전한 대립 관계에 있지만, 사실 완벽한 CP 시스템과 AP 시스템은 쓸모가 없다. 또한, CA 시스템은 가질 수 없다.

- 완벽한 CP : 완벽한 일관성을 갖는 분산 시스템에서는 하나의 트랜잭션에 대한 복사본을 모든 노드가 가져야 한다. 시스템의 전체 성능은 네트워크에서 가장 낮은 성능의 노드에 종속되며, 만일 단 하나의 노드라도 문제가 발생하면 트랜잭션 처리는 실패한다. 또한, 노드 수가 많아질 수록 지연시간이 길어진다.
- 완벽한 AP : 완벽한 가용성을 갖는 분산 시스템은 네트워크 분할로 인해 고립된 노드가 발생하더라도 서비스를 제공한다. 고립된 노드는 업데이트를 반영하지 못해 일관성이 결여된 잘못된 정보를 가지고 있지만, 완벽한 AP 시스템에서는 어찌됐든 가용한다. 이 때, 사용자는 잘못된 정보를 받고 활용하게 된다.
- 완벽한 CA : 완벽한 CA 시스템을 위해서는 절대로 장애가 발생하지 않는 네트워크를 구성해야 한다. 불가하다.



-> 실제로는 일관성과 가용성의 절충안에 해당하는 연속적인 중간 영역이 존재한다. 이를 고려하여 네트워크의 정상 상황과 분할 상황을 모두 담아 낼 수 있는 PACELC 이론이 있다.

![2](../../images/2022-10-24-blockchainArch/2.png)

{: .align-center}

위와 같이 PACELC는 분할 시, 가용성과 일관성 사이의 트레이드 오프가, 그렇지 않다면, 지연시간과 일관성 사이의 트레이드 오프가 있음을 의미한다.

- 네트워크 분할 상황(P) : 단절된 노드에 접근할 수 없기 때문에 일관성을 포기하고 가용성을 제공할 지(PA),  가용성을 포기하고 일관성을 유지할지(PC)의 정도를 결정해야 한다.
- 네트워크 정상 상황(E) : 모든 노드에 업데이트를 반영해 일관성을 유지하기 위한 긴 대기 및 응답시간을 가질지(EC), 일관성을 포기하고 짧은 지연시간을 가질지(EL)의 정도를 결정해야 한다.



## 각 이론에서의 블록체인



### CAP 관점에서의 블록체인

---

CAP 관점에서의 블록체인은 가용성과 분할 허용을 충족하는 AP 시스템이다. 그러나 통상 AP 시스템은 고성능을 위하지만, 블록체인 시스템은 자가 제한을 통해 성능을 제한한다는 점이 특이하다. 이를 통해 블록체인에서는 과거 블록의 위/변조를 어렵게 만들고 궁극적 일관성을 확보했다. 이러한 특징은 블록체인 트릴레마로 이어진다.



### PACELC 관점에서의 블록체인

---

PACELC 관점에서의 블록체인은 일관성보다 가용성과 지연시간을 중시한 분산 시스템이다. 그러나 마찬가지로 시간이 지남에 따라 과거의 블록 및 트랜잭션에 대한 궁극적 일관성을 확보한다.

- 네트워크 분할 상황(P) : 분할 상황에서 블록체인은 일관성보다는 가용성에 초점을 둔다. 채굴자는 자신이 참조하고 있는 블록이 네트워크에서 아직 합의를 이루지 못했다고 해도 이전 블록으로 삼아 채굴을 이어간다.
- 네트워크 정상 상황(E) : 정상 상황에서 블록체인은 일관성보다는 짧은 지연시간에 초점을 둔다. 블록체인에서는 채굴된 새 블록 혹은 더 무거운 체인 등을 통해 원장의 업데이트가 제안되는데, 모든 노드가 이를 따를 필요는 없다.



 
